# 데이터 웨어하우스를 이용한 대시보드 구성
## 주제: 영화 트렌드 대시보드
## Programmers 데브코스 Data Engineering 5기 
- <b>Team</b>`1잘하조`
  - <b>김동환 `영화별 매출액,전날 관객수 데이터 수집` `ETL` `대시보드 시각화`</b>
  - <b>윤대열 `상영관 별 관객 수 데이터 수집` `ETL` `대시보드 시각화`</b>
  - <b>이상원 `장르별(+기간) 관객 수 데이터 수집` `ETL` `대시보드 시각화`</b>
  - <b>설연수 `기간(연간,월간,주간 등)별 관객 수 데이터 수집` `ETL` `대시보드 시각화`</b>
  - <b>김유빈 `배우별 인지도 데이터 수집` `ETL` `대시보드 시각화`</b>
- **프로젝트 진행 기간**: 2025.01.06 ~ 2025.01.09

## 목차
###### 1. 프로젝트 개요
###### 2. 활용 기술
###### 3. 프로젝트 결과 및 세부내용
###### 4. 프로젝트 결론

## 1. 프로젝트 개요
### 프로젝트 주제 선정
영화 산업은 문화와 경제에 큰 영향을 미치는 분야로, 끊임없이 변화하는 관객의 선호도와 트렌드를 분석하는 것이 중요합니다.
  
최근 OTT 플랫폼의 확산, 특정 장르의 인기도 변화 등 영화 시장의 복잡성이 증가하며,
  
데이터 기반 의사 결정의 필요성이 커지고 있기에 이번 주제를 기획하게 되었습니다.
  
### 프로젝트 주요 목표
- AWS S3, Redshift, Superset(Preset) 등 최신 클라우드 및 데이터 시각화 기술을 활용
- 대용량 데이터의 분석
- 직관적이고 유용한 대시보드 시스템 구축

### 기술적 목표
- 웹크롤링, OPEN API를 이용하여 데이터 수집
- AWS S3에 데이터 적재 및 전처리
- Redshift에 COPY하여 사용 및 이해
- Superset(Preset)을 사용하여 Chart 작성 및 Dashboard 제작하여 데이터 시각화

## 2. 활용 기술 
### 데이터 소스
> [KOFIC 영화관 입장권 통합전산망 :: 일별 박스오피스](https://www.kobis.or.kr/kobis/business/stat/boxs/findDailyBoxOfficeList.do)

> [KOBIS OPEN API 서비스](https://www.kobis.or.kr/kobisopenapi/homepg/main/main.do)

### 데이터 수집
`Python` `Selenium` `Requests`

### 데이터 처리
`pywin32` `Pandas`

### 데이터 적재
`AWS S3` `AWS Redshift` `boto3` `Python Schedule`

### 데이터 시각화
`Preset`

### 협업 Tools
`Github` `Slack` `Zep` `Notion`

## 3. 프로젝트 결과 및 세부내용
<img src="https://github.com/user-attachments/assets/5cfce004-4e93-4bad-8c88-10c8dc5a8bf5"  width="1000" height="500"/><br>

### 영화 별 매출액, 전날 관객 수
<img src="https://github.com/user-attachments/assets/503a92c2-7141-419f-a8fb-e58560f91764"  width="800" height="1000"/><br>
#### 데이터 수집
##### 영화 별 매출액 
-영화진흥위원회(KOFIC)의 영화관입장권 통합전산망에서 개봉일 기준 최근 5년치 (2020 ~ 2024) 데이터를 1년치 단위로 수집하였습니다.
##### 전날 관객 수
- 영화진흥위원회(KOFIC)의 OPEN API 서비스를 이용하여 일별 박스오피스를 수집하였습니다.
#### 데이터 전처리
##### 영화 별 매출액
- 수집한 파일들이 .xls 형식이어서 전처리하는 과정에서 오류가 발생하였습니다. 이를 해결하기 위해 파일 형식을 .xlsx로 변환하였습니다.
- xlsx 파일에서 1년 당 약 1500개의 영화들이 있어서 각 연도별로 매출액 상위 20개 영화만 남기고 삭제하는 전처리를 우선 진행하였습니다.
- 1차 전처리된 xlsx파일들을 병합하면서 csv파일로 변환하였습니다. 이 과정에서 불필요한 빈 행 삭제와 int형 변환 등 필요한 전처리를 추가 진행하였습니다.
- 변환된 csv파일의 헤더를 영어로 변경해주면서, 열에 쉼표가 있으면 적재 과정에서 오류가 발생하여 모든 열에서 쉼표도 제거해주었습니다.
##### 전날 관객 수
- API을 사용하여 일별 박스오피스 데이터를 수집과 동시에 csv파일로 저장하였습니다.
- 기존 csv파일의 헤더를 알아보기 쉽게 변경하였습니다.
- csv파일에 voting_date 열을 추가하여 언제 가져온 데이터인지 알 수 있게 하였습니다.

> 이 데이터는 매일 새로운 데이터를 수집하여 DB에 새롭게 적재 해주어야 하기 때문에 수집부터 Redshift 적재까지 한 번에 수행하는 코드를 
파이썬 schedule 라이브러리를 활용하여 작성하였습니다. 

### 장르 별(+기간) 관객 수
<img src="https://github.com/user-attachments/assets/1ee9c984-23d1-4451-bd7a-423627fc9310"  width="1000" height="800"/><br>
#### 데이터 수집
- Selenium을 활용하여 영화진흥위원회(KOFIC)의 영화관입장권 통합전산망에서 2019년 12월 17일부터 약 5년간의 일별 박스오피스 데이터를 1주일 단위로 수집하였습니다
- KOFIC 웹사이트에서 데이터를 수집하기 위해 데이터 수집 시작일을 설정한 뒤, HTML 클래스 이름 또는 Xpath를 기반으로 달력 아이콘, 연도, 월, 일 선택 버튼, 조회 버튼, 그리고 엑셀 다운로드 버튼의 위치를 식별하고 클릭 액션을 사용하였습니다. 또한, 다운로드 시 나타나는 시간이 걸릴 수 있다는 팝업 창을 닫는 액션을 추가하여 프로세스를 자동화했습니다. 약 5년간의 데이터를 수집하였으며, 1주일 치 데이터를 다운로드할 때 생성되는 파일에는 데이터가 일 단위로 구분되어 저장하였습니다.
#### 데이터 전처리
- 다운로드된 파일들은 .xls 형식이었으나, pandas로 데이터를 불러오는 과정에서 오류가 발생하였습니다. 이를 해결하기 위해 pywin32 패키지를 사용하여 파일 형식을 .xlsx로 변환한 뒤, 변환된 파일을 새로 생성한 폴더에 저장하였습니다.
- xlsx 파일에서 첫 4개의 행은 수집 대상 데이터와 관련이 없어 건너뛰었습니다. 이후, ‘순위’와 ‘합계’가 포함된 행 번호를 식별하여, 이들 사이에 있는 일별 데이터를 추출하였습니다. 또한, ‘순위’ 행의 바로 위에 위치한 날짜 정보를 활용하여 집계일을 나타내는 ‘voting_date’ 컬럼을 생성하였습니다. 데이터 조회를 보다 용이하게 하기 위해 모든 컬럼 명을 영문으로 변경하였으며, 일별 데이터를 하나의 파일로 통합하기 위해 pandas의 pd.concat 함수를 사용하여 하나의 데이터 프레임으로 구성 후 csv 파일로 저장하였습니다.
- 일부 영화는 1개 이상의 장르를 가질 수 있으므로, NaN 값을 제거한 뒤 영화와 장르를 1대1로 매핑했습니다. 이후, 해당 영화의 관객 수가 포함된 데이터프레임을 생성하고 이를 CSV 파일로 저장하였습니다.

### 상영관 별 관객 수
<img src="https://github.com/user-attachments/assets/2ccc3496-d583-479a-9a34-633a09ff1518"  width="1000" height="800"/><br>
#### 데이터 수집
- 엑셀 파일을 다운로드받는 방식은 파일 형식의 제약이 있었고, 일주일 단위로만 데이터를 조회할 수 있었습니다. 이러한 문제를 해결하기 위해 HTML을 파싱하여 필요한 데이터만 직접 다운로드하는 방식을 사용했습니다. Selenium을 사용해 웹사이트의 달력 UI를 제어하며 시작 날짜와 종료 날짜를 지정한 뒤, 조회 버튼을 클릭하여 데이터를 불러옵니다. 이후 BeautifulSoup으로 페이지 소스를 파싱하여 영화명, 체인명, 상영 횟수, 상영 점유율 등의 필요한 데이터를 표에서 추출합니다.
- 2019년 1월 1일부터 2025년 1월 6일까지의 기간을 설정하고 수집했습니다.
#### 데이터 전처리
- 웹에서 조회기간을 설정하면 일주일 단위로 역순으로 데이터가 조회되었습니다. 예를 들어 2024년 12월 31일을 기준으로 데이터를 조회하면, 그 일주일 후인 2025년 1월 6일부터 1월 5일, 1월 4일, ... 12월 31일 순서로 조회되었습니다.
- 데이터가 일주일 단위로 역순으로 정렬되어 출력되었기 때문에, 이를 올바른 날짜 순으로 정렬하기 위해 전처리 코드를 작성했습니다. 데이터를 그룹화하여 각 그룹의 날짜를 순차적으로 변환한 뒤, Pandas의 datetime 형식으로 날짜 데이터를 정리하고 이를 기준으로 데이터를 정렬했습니다.
- 추후 분석을 위해 날짜에서 요일 정보를 추출해 별도의 컬럼으로 추가했고, .상영 점유율 데이터를 퍼센트 기호를 제거한 후 실수형으로 변환했습니다.

### 기간(연간,월간,주간) 별 관객 수
<img src="https://github.com/user-attachments/assets/c8ef18a9-8b17-4ed4-9856-d1670d9d3cca"  width="1000" height="800"/><br>
#### 데이터 수집
- 영화진흥위원회(KOFIC) 사이트에서 주간/월간/연간 박스오피스 정보를 제공하고 있습니다. 해당 사이트를 크롤링 하여 필요한 엑셀 파일을 다운로드 하였습니다.
- 데이터는 2020년 1월 부터 2024년 12월까지의 데이터를 수집하였습니다.
#### 데이터 전처리
- 엑셀 파일이 이전 버전(xls)인 이슈가 있어 우선 xlsx 파일 형식으로 변환하는 과정을 거쳤습니다.
- xlsx 파일 형식으로 엑셀을 정상적으로 로드하면 데이터만 추출 하여 csv 파일로 만들었습니다.

### 배우별 인지도
<img src="https://github.com/user-attachments/assets/5d386883-3e67-4229-88fb-e77006c18c1d"  width="450" height="400"/>
<img src="https://github.com/user-attachments/assets/591eb849-9d5b-492e-a958-b58e90901a48"  width="450" height="400"/>
<img src="https://github.com/user-attachments/assets/789e7121-7454-40c2-91c9-cc7fa2c552c5"  width="450" height="400"/>
<img src="https://github.com/user-attachments/assets/afed85ab-8e59-4a42-93ad-7b3f610e5c78"  width="450" height="400"/><br>

#### 데이터 수집
- 초기 프로젝트 기간 전 상단의 KOFIC 사이트에서 박스오피스 정보를 엑셀로 저장 받아 이를 통합하는 과정을 거쳤습니다. selenium 활용으로 기간 설정을 변경해 5년치 데이터를 받아서 이를 통합, 중요 과정으로 utf-8-sig 설정과 기간이 겹치지 않는 것을 확인 등이 있었습니다.
#### 데이터 전처리
- 이전에 수집한 데이터와 가장 유사하고 넓은 범위의 사용 가능한 데이터 셋을 바탕으로 이를 전처리 했습니다. - combined_data
- 엑셀에서 기본적인 처리를 진행한 후에 파이썬에서 데이터 베이스 적재가 가능하도록 후 처리를 진행했습니다.
  - 엑셀의 경우 필요한 column 추출, 데이터 전처리 방향을 위한 summury 진행
  - 파이썬에서는 해당 파일의 utf-8-sig 처리, 데이터의 포멧 정리, 데이터의 양을 줄이기 위한 filter_by_total_audience, 결측치 처리 등을 진행
  - sql 에서의 작업을 위해 table 분리를 위한 처리 진행

## 4. 프로젝트 결론

### 기대효과
- **시장 트렌드 분석**
  
  `매출액과 관객 수 데이터를 통해 인기 영화와 흥행 요인 분석 가능`
  
- **운영 효율화**
  
  `상영관 별 관객 수 데이터를 통해 상영 스케줄 최적화 및 자원 배분 개선`

- **마케팅 전략 수립**
  
  `배우별 인지도와 관련 데이터 활용하여 홍보 및 캐스팅 전략 수립`
  
  `전날 관객 수 데이터를 기반으로 변동성 감지하여 광고 캠페인 조정 가능`

- **데이터 기반 의사결정 촉진**
  
  `모든 데이터를 통합적으로 분석하여 데이터 중심의 의사결정을 촉진하고,`
  
  `결과적으로 영화 산업의 경쟁력을 높이는 데 기여할 수 있다.`

### 개선점
- 이번 프로젝트에서 추출한 데이터의 크기가 크지 않아 CSV로 저장을 했지만 향후 데이터 량이 커지면

  parquet이나 avro 파일로 저장하는 것을 검토하는 것도 좋을 것 같습니다.
- 팀원 1분이 맡은 부분이 전날 관객수 데이터를 추출해야해서 주기적으로 데이터를 수집을 해야 했지만
  
  다른 부분도  주기적으로 데이터를 수집하면 프로젝트를 고도화 할 수 있을 것 같습니다.
- 전날 관객수 데이터를 매일 업데이트하는 과정에서 파이썬의 schedule 라이브러리를 사용했는데
  
  AWS lambda 또는 Airflow를 사용해서 할 수 있으면 더 좋을 것 같습니다.
